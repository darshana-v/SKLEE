<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Smart Contract Verifier: klee/lib/Core/MergeHandler.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo-2.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Smart Contract Verifier
   &#160;<span id="projectnumber">Soldity 0.6.10</span>
   </div>
   <div id="projectbrief">Verification of Real world Etherium Smart Contracts.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_merge_handler_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">MergeHandler.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation of the region based merging.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="_ref_8h_source.html">klee/ADT/Ref.h</a>&quot;</code><br />
<code>#include &quot;llvm/Support/CommandLine.h&quot;</code><br />
<code>#include &lt;map&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;vector&gt;</code><br />
</div>
<p><a href="_merge_handler_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classklee_1_1_merge_handler.html">klee::MergeHandler</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents one <code><a class="el" href="klee_8h.html#ad233b9c4fad8c2ca0018b8235b72e91a">klee_open_merge()</a></code> call.  <a href="classklee_1_1_merge_handler.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespacellvm"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacellvm.html">llvm</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:namespaceklee"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceklee.html">klee</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a59ed4878f1f45e8babf90aba7a813474"><td class="memItemLeft" align="right" valign="top">llvm::cl::opt&lt; <a class="el" href="pcregrep_8c.html#a97a80ca1602ebf2303258971a2c938e2">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceklee.html#a59ed4878f1f45e8babf90aba7a813474">klee::UseMerge</a></td></tr>
<tr class="separator:a59ed4878f1f45e8babf90aba7a813474"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a681a411cfb19deb338557ae7ac3b2c69"><td class="memItemLeft" align="right" valign="top">llvm::cl::opt&lt; <a class="el" href="pcregrep_8c.html#a97a80ca1602ebf2303258971a2c938e2">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceklee.html#a681a411cfb19deb338557ae7ac3b2c69">klee::DebugLogMerge</a></td></tr>
<tr class="separator:a681a411cfb19deb338557ae7ac3b2c69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a459af63ae00d250b8341c343a82f67f7"><td class="memItemLeft" align="right" valign="top">llvm::cl::opt&lt; <a class="el" href="pcregrep_8c.html#a97a80ca1602ebf2303258971a2c938e2">bool</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceklee.html#a459af63ae00d250b8341c343a82f67f7">klee::DebugLogIncompleteMerge</a></td></tr>
<tr class="separator:a459af63ae00d250b8341c343a82f67f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of the region based merging. </p>
<h2><a class="anchor" id="autotoc_md1"></a>
Basic usage:</h2>
<div class="fragment"><div class="line"><a class="code" href="klee_8h.html#ad233b9c4fad8c2ca0018b8235b72e91a">klee_open_merge</a>();</div>
<div class="line"> </div>
<div class="line">code containing <a class="code" href="_copy_on_write_8c.html#ae7cc1a7ffd96d25fb6bcc4f85d2a9f7e">branches</a> etc. </div>
<div class="line"> </div>
<div class="line"><a class="code" href="klee_8h.html#a5e1ef03f85a0f0977232012cbea4c63a">klee_close_merge</a>();</div>
<div class="ttc" id="a_copy_on_write_8c_html_ae7cc1a7ffd96d25fb6bcc4f85d2a9f7e"><div class="ttname"><a href="_copy_on_write_8c.html#ae7cc1a7ffd96d25fb6bcc4f85d2a9f7e">branches</a></div><div class="ttdeci">unsigned branches</div><div class="ttdef"><b>Definition:</b> CopyOnWrite.c:9</div></div>
<div class="ttc" id="aklee_8h_html_a5e1ef03f85a0f0977232012cbea4c63a"><div class="ttname"><a href="klee_8h.html#a5e1ef03f85a0f0977232012cbea4c63a">klee_close_merge</a></div><div class="ttdeci">void klee_close_merge()</div></div>
<div class="ttc" id="aklee_8h_html_ad233b9c4fad8c2ca0018b8235b72e91a"><div class="ttname"><a href="klee_8h.html#ad233b9c4fad8c2ca0018b8235b72e91a">klee_open_merge</a></div><div class="ttdeci">void klee_open_merge()</div></div>
</div><!-- fragment --><p>Will lead to all states that forked from the state that executed the <a class="el" href="klee_8h.html#ad233b9c4fad8c2ca0018b8235b72e91a">klee_open_merge()</a> being merged in the <a class="el" href="klee_8h.html#a5e1ef03f85a0f0977232012cbea4c63a">klee_close_merge()</a>. This allows for fine-grained regions to be specified for merging.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Implementation Structure</h1>
<p>The main part of the new functionality is implemented in the class <a class="el" href="classklee_1_1_merge_handler.html" title="Represents one klee_open_merge() call.">klee::MergeHandler</a>. The Special Function Handler generates an instance of this class every time a state runs into a <a class="el" href="klee_8h.html#ad233b9c4fad8c2ca0018b8235b72e91a">klee_open_merge()</a> call.</p>
<p>This instance is appended to a <code>std::vector&lt;<a class="el" href="classklee_1_1ref.html">klee::ref</a>&lt;<a class="el" href="classklee_1_1_merge_handler.html" title="Represents one klee_open_merge() call.">klee::MergeHandler</a>&gt;&gt;</code> in the ExecutionState that passed the merge open point. This stack is also copied during forks. We use a stack instead of a single instance to support nested merge regions.</p>
<p>Once a state runs into a <code><a class="el" href="klee_8h.html#a5e1ef03f85a0f0977232012cbea4c63a">klee_close_merge()</a></code>, the Special Function Handler notifies the top <a class="el" href="classklee_1_1_merge_handler.html" title="Represents one klee_open_merge() call.">klee::MergeHandler</a> in the state's stack, pauses the state from scheduling, and tries to merge it with all other states that already arrived at the same close merge point. This top instance is then popped from the stack, resulting in a decrease of the ref count of the <a class="el" href="classklee_1_1_merge_handler.html" title="Represents one klee_open_merge() call.">klee::MergeHandler</a>.</p>
<p>Since the only references to this MergeHandler are in the stacks of the ExecutionStates currently in the merging region, once the ref count reaches zero, every state which ran into the same <code><a class="el" href="klee_8h.html#ad233b9c4fad8c2ca0018b8235b72e91a">klee_open_merge()</a></code> is now paused and waiting to be merged. The destructor of the MergeHandler then continues the scheduling of the corresponding paused states.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Non-blocking State Merging</h1>
<p>This feature adds functionality to the BoundedMergingSearcher that will prioritize (e.g., immediately schedule) states running inside a bounded-merge region once a state has reached a corresponding <a class="el" href="klee_8h.html#a5e1ef03f85a0f0977232012cbea4c63a">klee_close_merge()</a> call. The goal is to quickly gather all states inside the merging region in order to release the waiting states. However, states that are running for more than twice the mean number of instructions compared to the states that are already waiting, will not be prioritized anymore.</p>
<p>Once no more states are available for prioritizing, but there are states waiting to be released, these states (which have already been merged as good as possible) will be continued without waiting for the remaining states. When a remaining state now enters a close-merge point, it will again wait for the other states, or until the 'timeout' is reached. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_3fd910164f6a406873c6ab0e6c1a579b.html">klee</a></li><li class="navelem"><a class="el" href="dir_9abda1ed4895a2e50943d7a46bd5c9d6.html">lib</a></li><li class="navelem"><a class="el" href="dir_4c36943aaa2435d083d02edb33f2d9fc.html">Core</a></li><li class="navelem"><a class="el" href="_merge_handler_8h.html">MergeHandler.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
