{"SourceCode":"// VIURE Founders Token Sale Smart Contract for VR Arcades\r\n\r\npragma solidity ^0.4.6;\r\n\r\ncontract VIUREFoundersTokenSale {\r\n  // Maps addresses to balances in ETH\r\n  mapping (address => uint) public balances;\r\n\r\n  uint public transferred_total = 0;\r\n\r\n  // Minimum and Maximum Goals for Token Sale\r\n  uint public constant min_goal_amount = 4000 ether;\r\n  uint public constant max_goal_amount = 6000 ether;\r\n\r\n  // loftVR Offline Project Wallet\r\n  address public project_wallet;\r\n\r\n  // Token Sale Schedule\r\n  uint public token_sale_start_block;\r\n  uint public token_sale_end_block;\r\n\r\n  // Approximate blocks created in 2 months - 351,558 blocks\r\n  uint constant blocks_in_two_months = 360000;\r\n\r\n  // Block number at the end of the refund window\r\n  uint public refund_window_end_block;\r\n\r\n  function VIUREFoundersTokenSale(uint _start_block, uint _end_block, address _project_wallet) {\r\n    if (_start_block <= block.number) throw;\r\n    if (_end_block <= _start_block) throw;\r\n    if (_project_wallet == 0) throw;\r\n\r\n    // Initializing parameters for Token Sale\r\n    token_sale_start_block = _start_block;\r\n    token_sale_end_block = _end_block;\r\n    project_wallet = _project_wallet;\r\n    refund_window_end_block = token_sale_end_block + blocks_in_two_months;\r\n  }\r\n\r\n  // Checks if the Token Sale has started\r\n  function has_token_sale_started() private constant returns (bool) {\r\n    return block.number >= token_sale_start_block;\r\n  }\r\n\r\n  // Checks if the Token Sale has ended\r\n  function has_token_sale_time_ended() private constant returns (bool) {\r\n    return block.number > token_sale_end_block;\r\n  }\r\n\r\n  // Checks if the minimum goal was reached\r\n  function is_min_goal_reached() private constant returns (bool) {\r\n    return transferred_total >= min_goal_amount;\r\n  }\r\n\r\n  // Checks if the maximum goal was reached\r\n  function is_max_goal_reached() private constant returns (bool) {\r\n    return transferred_total >= max_goal_amount;\r\n  }\r\n\r\n  // Accepts ETH while Token Sale is active or until the maximum goal is reached\r\n  function() payable {\r\n    // Check if Token Sale has started\r\n    if (!has_token_sale_started()) throw;\r\n\r\n    // Check if Token Sale is over\r\n    if (has_token_sale_time_ended()) throw;\r\n\r\n    // Don't accept transactions with zero value\r\n    if (msg.value == 0) throw;\r\n\r\n    // Check if the maximum goal was reached\r\n    if (is_max_goal_reached()) throw;\r\n\r\n    // Check if senders transaction ends up going over the maximum goal amount\r\n    if (transferred_total + msg.value > max_goal_amount) {\r\n      // Return as change the amount that goes over the maximum goal amount\r\n      var change_to_return = transferred_total + msg.value - max_goal_amount;\r\n      if (!msg.sender.send(change_to_return)) throw;\r\n\r\n      // Records what the sender was able to send to reach the maximum goal amount\r\n      // Adds this value to the senders balance and to transferred_total to finish the Token Sale\r\n      var to_add = max_goal_amount - transferred_total;\r\n      balances[msg.sender] += to_add;\r\n      transferred_total += to_add;\r\n\r\n    } else {\r\n      // Records the value of the senders transaction with the Token Sale Smart Contract\r\n      // Records the amount the sender sent to the Token Sale Smart Contract\r\n      balances[msg.sender] += msg.value;\r\n      transferred_total += msg.value;\r\n    }\r\n  }\r\n\r\n  // Transfer ETH to loftVR Offline Project wallet\r\n  function transfer_funds_to_project() {\r\n    // Check if the minimum goal amount was reached\r\n    if (!is_min_goal_reached()) throw;\r\n    // Check if the funds have already been transferred to the project wallet\r\n    if (this.balance == 0) throw;\r\n\r\n    // Transfer ETH to loftVR Offline Project wallet\r\n    if (!project_wallet.send(this.balance)) throw;\r\n  }\r\n\r\n  // Refund ETH in case the minimum goal was not reached during the Token Sale\r\n  // Refund will be available during a two month window after the Token Sale\r\n  function refund() {\r\n    // Check if the Token Sale has ended\r\n    if (!has_token_sale_time_ended()) throw;\r\n    // Check if the minimum goal amount was reached and throws if it has been reached\r\n    if (is_min_goal_reached()) throw;\r\n    // Check if the refund window has passed\r\n    if (block.number > refund_window_end_block) throw;\r\n\r\n    // Records the balance of the sender\r\n    var refund_amount = balances[msg.sender];\r\n    // Check if the sender has a balance\r\n    if (refund_amount == 0) throw;\r\n\r\n    // Reset balance\r\n    balances[msg.sender] = 0;\r\n\r\n    // Actual refund\r\n    if (!msg.sender.send(refund_amount)) {\r\n         if (!msg.sender.send(refund_amount)) throw;\r\n    }\r\n  }\r\n\r\n  // In the case that there is any ETH left unclaimed after the two month refund window,\r\n  // Send the ETH to the loftVR Offline Project Wallet\r\n  function transfer_remaining_funds_to_project() {\r\n    if (!has_token_sale_time_ended()) throw;\r\n    if (is_min_goal_reached()) throw;\r\n    if (block.number <= refund_window_end_block) throw;\r\n\r\n    if (this.balance == 0) throw;\r\n    // Transfer remaining ETH to loftVR Offline Project Wallet\r\n    if (!project_wallet.send(this.balance)) throw;\r\n  }\r\n}","ABI":"[{\"constant\":true,\"inputs\":[],\"name\":\"refund_window_end_block\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"\",\"type\":\"address\"}],\"name\":\"balances\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"min_goal_amount\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"transfer_remaining_funds_to_project\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"refund\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"token_sale_end_block\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"project_wallet\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"transfer_funds_to_project\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"transferred_total\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"token_sale_start_block\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"max_goal_amount\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"inputs\":[{\"name\":\"_start_block\",\"type\":\"uint256\"},{\"name\":\"_end_block\",\"type\":\"uint256\"},{\"name\":\"_project_wallet\",\"type\":\"address\"}],\"payable\":false,\"type\":\"constructor\"},{\"payable\":true,\"type\":\"fallback\"}]","ContractName":"VIUREFoundersTokenSale","CompilerVersion":"v0.4.6+commit.2dabbdf0","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"000000000000000000000000000000000000000000000000000000000030d400000000000000000000000000000000000000000000000000000000000036ee800000000000000000000000001bffad6a8d699143c3226dd788af63a5f921b410","Library":"","LicenseType":"","SwarmSource":""}
